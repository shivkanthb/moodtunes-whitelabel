angular.module("app.services").service("audio",["$http","$rootScope","$location","GENERAL_CONFIG","mixService",function(n,e,t,o,i){function u(){$("#progress").css("width",this.position/this.duration*100+"%")}function a(){d.state=g.PLAYING}function s(){d.state=g.STOPPED}function l(n){n||d.PlayNextSong()}function r(){d.PlayNextSong()}var g={STOPPED:"stopped",PLAYING:"playing"},c=null,d={state:g.STOPPED};return soundManager.setup({useConsole:!1,debugMode:!1,defaultOptions:{onplay:a,onpause:s,onresume:a,onload:l,onfinish:r,whileplaying:u}}),d.TogglePlayState=function(){return c?void(c.paused?c.resume():c.pause()):void this.PlaySong()},d.PlaySong=function(n){n||(n=i.GetFirstTrack()),c&&c.destruct();var a=n.stream_url+"?client_id="+o.SOUNDCLOUD_CLIENT_ID;c=soundManager.createSound({id:n.id,url:a,consumer_key:o.SOUNDCLOUD_CLIENT_ID,whileplaying:u}),soundManager.setVolume(c.id,e.volume),i.SetPlaying(i.CurrentMix.id,n),c.play(),$(".play-mix-button").toggle(),t.path(i.CurrentCollection+"/"+i.CurrentMix.slug+"/"+n.slug,!1)},d.PlayNextSong=function(){var n=this;i.GetNextTrack(c.id).then(function(e){n.PlaySong(e)})},d.PlayPreviousSong=function(){var n=this;i.GetPreviousTrack(c.id).then(function(e){n.PlaySong(e)})},d.SetVolume=function(n){soundManager.setVolume(c.id,n)},d.ToggleMute=function(){soundManager.toggleMute(c.id)},d}]);